services:
  - type: web
    name: sistemarestaurante-api
    runtime: docker
    plan: starter
    region: oregon
    dockerfilePath: ./Dockerfile

    envVars:
      # Render envía valores separados. Creamos la URL JDBC correcta.
      - key: SPRING_DATASOURCE_URL
        value: jdbc:postgresql://${RENDER_EXTERNAL_HOST}:${RENDER_EXTERNAL_PORT}/${RENDER_DATABASE_NAME}

      - key: SPRING_DATASOURCE_USERNAME
        fromDatabase:
          name: sistemarestaurante-db
          property: user

      - key: SPRING_DATASOURCE_PASSWORD
        fromDatabase:
          name: sistemarestaurante-db
          property: password

      # Render crea estas variables automáticamente (las usamos en la URL)
      - key: RENDER_EXTERNAL_HOST
        fromDatabase:
          name: sistemarestaurante-db
          property: host

      - key: RENDER_EXTERNAL_PORT
        fromDatabase:
          name: sistemarestaurante-db
          property: port

      - key: RENDER_DATABASE_NAME
        fromDatabase:
          name: sistemarestaurante-db
          property: database

      # Puerto de Spring Boot
      - key: PORT
        value: 8080

      - key: SERVER_PORT
        value: 8080

      # Stripe (ya las agregaste en Environment)
      - key: STRIPE_PUBLIC_KEY
        sync: false
      - key: STRIPE_SECRET_KEY
        sync: false
      - key: STRIPE_WEBHOOK_SECRET
        sync: false

databases:
  - name: sistemarestaurante-db
    plan: free
